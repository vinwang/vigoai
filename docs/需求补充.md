
---

# 项目概述：AI漫导 (AI漫导 Agent)

## 1. 定位与愿景

**AI漫导** 是一款基于 **Agent 架构** 的多模态内容创作安卓应用。它不仅仅是一个聊天工具，而是一个“AI漫导”。
该应用利用大模型（GLM）的理解与规划能力，将用户碎片化的创意（自然语言）转化为完整的视频剧本，并自动调度底层视觉模型执行“文生图”和“图生视频”的复杂流水线，最终交付成品短剧。

---

## 2. 核心执行流程：Agent 闭环

项目最核心的逻辑是基于 GLM 打造的 **“规划-执行-合成”** 三位一体工作流：

### 阶段一：脚本规划层 (Brain/Planner) —— “导演构思”

* **用户交互**：用户发送需求（例如：“制作一段赛博朋克风格的小猫在街头比武的视频”）。
* **Agent 行为**：GLM 不直接回答，而是启动 **脚本规划逻辑**。
* **逻辑产出**：GLM 输出结构化数据，包含：
* **剧情大纲**：故事的起承转合。
* **分镜参数**：为每一幕生成精准的 **Visual Prompt**（用于生图）和 **Motion Prompt**（用于控制动作）。
* **旁白/对话**：视频的文案内容。



### 阶段二：资产创作层 (Worker/Visualizer) —— “美术绘制”

* **指令下发**：系统自动提取阶段一生成的 `image_prompts`。
* **接口调度**：通过 Dio 异步调用 **文生图模型（如 CogView3）**。
* **资产固化**：将抽象的文字描述转化为 **关键帧图片**。这些图片将作为视频生成的视觉基座（Base Image），确保视频的第一帧符合剧本设定。

### 阶段三：动态合成层 (Synthesizer/Animator) —— “后期剪辑”

* **多模态注入**：将阶段二生成的 **图片 URL** 与阶段一生成的 **动作提示词（Video Prompts）** 结合。
* **视频生成**：调用 **图生视频接口（如 CogVideoX）**。
* **异步跟踪**：利用异步轮询机制监控视频渲染状态，最终获取 `.mp4` 资源。

---

## 3. 技术实现架构 (面向 Java 开发者的视角)

你可以将本项目理解为一个典型的 **Controller-Service-Model** 架构，但在客户端实现：

| 模块层级 | 对应技术 | Java 开发者理解 |
| --- | --- | --- |
| **UI View** | Flutter 3.0+ | 类似于 Android XML 或 Compose，负责响应式展示进度和多模态卡片。 |
| **Logic/State** | **Provider** | 类似于 **Spring Bean (Request Scoped)**。它管理 Agent 的全生命周期状态，驱动 UI 更新。 |
| **Networking** | **Dio** | 相当于 **Retrofit/OkHttp**。负责处理与智谱 API 的所有 Restful 交互及 TaskID 轮询。 |
| **Parser** | `json_serializable` | 相当于 **Jackson/Gson**。负责将 GLM 返回的 JSON 剧本反序列化为 Dart 对象。 |
| **Agent Controller** | 自定义 Workflow Logic | 这是项目的 **Main Loop**。它控制 `GLM -> Image API -> Video API` 的顺序执行和依赖传递。 |

---

## 4. 关键功能特性

* **结构化 Prompt 工程**：通过系统级的提示词约束，使 GLM 强制输出 JSON 格式，解决 Agent 在流水线中“胡言乱语”导致程序崩溃的问题。
* **异步任务管理**：针对视频生成动辄 1-2 分钟的耗时，设计了非阻塞的任务队列。用户可以在等待视频生成的同时，通过 `flutter_markdown` 先行阅读生成的剧本文字。
* **多模态混合渲染**：聊天界面不仅支持文本，还支持 Markdown 格式的剧本排版、图片预览组件以及视频播放组件的动态嵌入。
* **容错与重试逻辑**：每一幕的生成都是独立的（Scene-based）。如果某一幕图片生成失败，Agent 可以单独针对该场景进行重试，而无需从头开始。

---

## 5. 业务价值总结

本项目的本质是 **“提示词自动化（Prompt Automation）”**。用户只需提供一句话需求，其余所有专业级的生图、生视频提示词均由 GLM 内部生成并自动流转。你开发的 Flutter App 则是这套 Agent 逻辑的物理载体和交互中心。

---
